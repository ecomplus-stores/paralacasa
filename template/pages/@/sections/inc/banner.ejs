<%
// Extrai as variáveis que vamos usar do objeto 'opt'
const { link, img, mobile_img, title, alt, sync_load } = opt

// Tenta obter as dimensões da imagem principal para evitar layout shift (CLS)
const { width, height } = _.tryImageSize(img)
%>

<a
  href="<%= link || '#' %>"
  class="banner"
  aria-label="<%= alt || title || 'Banner' %>"
>
  <picture>
    <% if (mobile_img) { %>
      <source
        media="(max-width: 767px)"
        sizes="100vw"
        srcset="<%= mobile_img.replace(',w_2048', ',w_480') %> 480w,
                <%= mobile_img.replace(',w_2048', ',w_800') %> 800w"
      >
    <% } %>

    <source
      media="(min-width: 768px)"
      sizes="100vw"
      srcset="<%= img.replace(',w_2048', ',w_800') %> 800w,
              <%= img.replace(',w_2048', ',w_1200') %> 1200w,
              <%= img.replace(',w_2048', ',w_1600') %> 1600w"
    >

    <img
      src="<%= img.replace(',w_2048', ',w_1200') %>"
      alt="<%= alt || title %>"
      
      <%# Adiciona as dimensões para evitar que a página "pule" (resolve o CLS) %>
      <% if (width && height) { %>
        width="<%= width %>"
        height="<%= height %>"
      <% } %>

      <%# Apenas o primeiro banner carrega imediatamente. Os outros esperam (lazy load). %>
      <%# Isso resolve o "Adie o carregamento de imagens fora da tela" %>
      <% if (!sync_load) { %>
        loading="lazy"
      <% } %>
    >
  </picture>
</a>
